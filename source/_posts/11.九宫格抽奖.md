---
title: åä¸€ã€ä¹å®«æ ¼æŠ½å¥–
date: 2020-1-10
tags:
  - æŠ½å¥–
  - lottery
---

## ä¹å®«æ ¼æŠ½å¥–

<!-- more -->

![](/images/lottery.png)


- 1.jså®ç°
```javascript
    class Lottery{
        constructor({
            startBtnEl,
            giftAllEl,
            prizeIndex,
            delayTime,
            animateTime,
            clearActive,
            _luckyTimes,
            haveChange,
            successCallback = () => {}

        }){
            Object.assign(this,{
                startBtnEl, //  å¼€å§‹æŒ‰é’®
                giftAllEl, // æ‰€æœ‰å¥–å“å…¬å…±class
                prizeIndex: prizeIndex || 'è°¢è°¢å‚ä¸', // æŠ½ä¸­å¥–å“ä¸‹æ ‡
                _luckyTimes: _luckyTimes || 0, // æŠ½å¥–æ¬¡æ•°
                delayTime: delayTime || 3000, // å»¶æ—¶å¤šå°‘ç§’å¾—åˆ°ç»“æœ
                animateTime: animateTime || 200, // åŠ¨ç”»æ—¶é—´
                clearActive: clearActive || true, // æ¸…é™¤çŠ¶æ€
                haveChange: haveChange || false, // æ˜¯å¦è¿˜æœ‰æŠ½å¥–æœºä¼š
                successCallback // æŠ½ä¸­å¥–å“å›è°ƒ
            })
            this.$prizeItemsEl = null, // å¥–å“
            this.lotteryPrizeIndex = 0, // ä¹å®«æ ¼å¯¹åº”ä¸‹æ ‡
            this.timer = null, // å®šæ—¶å™¨
            this.init()
        }
        init(){
            this.$lotteryStartEl = document.querySelector(this.startBtnEl) 
            this.$prizeItemsEl = document.querySelectorAll(this.giftAllEl) // ğŸ…å¥–å“
            this.initStartEvent()
        }
        initStartEvent(){
            let haveChange = this.haveChange;
            const el = this.$lotteryStartEl
            el.onclick = () => {
                if (!el.classList.contains('disabled') ) {
                    this.setStartBtnStatus(true)
                    if (haveChange) {
                        // æœ‰æŠ½å¥–æœºä¼šï¼Œå¾—åˆ°æŠ½å¥–ç»“æœ
                        this.getTargetPrize()
                        this.handleStartAnimate()
                    } else {
                        // æ²¡æœ‰æŠ½å¥–æœºä¼šäº†
                        console.log('æ²¡æœ‰æŠ½å¥–æœºä¼šäº†')
                    }
                }
            }
        }
        // å¼€å§‹æŠ½å¥–åŠ¨ç”»
        handleStartAnimate(){
            this.lotteryPrizeIndex = 0
            this.timer = setInterval(() => {
                this.lotteryPrizeIndex = this.lotteryPrizeIndex === 8 ? 1 : this.lotteryPrizeIndex + 1;
                this.addPrizeMask();
                // è¿™é‡Œå¾ˆå·§å¦™ï¼Œlottery-prize_item_index å’Œhtmlä¸€è‡´
                document.querySelector(`.lottery-prize_item_${this.lotteryPrizeIndex}`).classList.remove('mask')
            }, this.animateTime)
            return this.timer
        }
        // æ·»åŠ æ‰€æœ‰å¥–å“çš„é®ç½©çŠ¶æ€
        addPrizeMask(){
            for (let i = 0, l = this.$prizeItemsEl.length; i < l; i++) {
                this.$prizeItemsEl[i].classList.add('mask')
            }
        }
        // æ¸…é™¤æ‰€æœ‰å¥–å“çš„é®ç½©çŠ¶æ€
        clearPrizeActive () {
            for (let i = 0, l = this.$prizeItemsEl.length; i < l; i++) {
                this.$prizeItemsEl[i].classList.remove('mask')
            }
        }
        // æŠ½å¥–ç»“æœ
        getTargetPrize(){
            // æ¨¡æ‹Ÿéšæœºå¾—åˆ°ä¸€ä¸ªç»“æœ
            let prizeIndex = this.prizeIndex;
            if(prizeIndex == 'è°¢è°¢å‚ä¸'){
                return
            }
            if(prizeIndex == 0 || prizeIndex == 9){
                prizeIndex = 1
            }
            // å»¶æ—¶å‡ ç§’å¾—åˆ°ç»“æœ
            setTimeout(() => {
                typeof this.successCallback === 'function' && this.successCallback(prizeIndex)
                this.stopPrizeAnimate(prizeIndex)
            }, this.delayTime)
        }
        // å…³é—­æŠ½å¥–åŠ¨ç”»
        stopPrizeAnimate(index){
            if (index) {
                let stopTimer = null
                stopTimer = setInterval(() => {
                    if (index === this.lotteryPrizeIndex ) {
                        clearInterval(stopTimer)
                        clearInterval(this.timer)
                        this.setStartBtnStatus()
                        if (this.clearActive) {
                            //this.clearPrizeActive()
                        }
                    }
                }, 100)
            } else {
                this.setStartBtnStatus()
                clearInterval(this.timer)
                this.clearPrizeActive()
            }
        }
        // æŒ‰é’®çŠ¶æ€
        setStartBtnStatus (status) {
            if (status) {
                this.$lotteryStartEl.classList.add('disabled')
            } else if (this._luckyTimes) { 
                this.$lotteryStartEl.classList.remove('disabled')
            }
        }
    }

    new Lottery({
        startBtnEl: '.J_lottery-start',
        giftAllEl: '.lottery-prize_item',
        prizeIndex:2 ,
        haveChange: true,
        _luckyTimes: 2,
        successCallback(prizeIndex){
            console.log('prizeIndex--->',prizeIndex)
        }
    })
```
- 2.htmlç»“æ„
```javascript
    <div class="lottery-prize_items">
        <div class="lottery-prize_item lottery-prize_item_1">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_2">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_3">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_8">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-start J_lottery-start ">GO! </div>
        <div class="lottery-prize_item lottery-prize_item_4">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_7">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_6">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
        <div class="lottery-prize_item lottery-prize_item_5">
            <img src="./ä¸‹è½½.jpeg" alt="">
        </div>
    </div>
```

- 3.css
```javascript
*{margin: 0; padding: 0;}
    .lottery-prize_items{
        width: 430px; 
        height:400px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-content: space-between;
        padding: 20px;
        background-color: #446CD3;
        border-radius: 5px;
    }
    .lottery-prize_items .lottery-prize_item, .lottery-prize_items .lottery-start{
        width: 120px;
        height: 120px;
        background: #D2DAFF;
        background: #fff;
        border-radius: 5px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        overflow: hidden;
    }
    .lottery-prize_items  .mask:after{
        display: block;
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 120px;
        background: rgba(94, 139, 255, 0.4);
        border-radius: 5px;
    }
    .lottery-prize_items .disabled{
        background: #C4C6CA;
        color: #fff;
    }
    .lottery-prize_items .lottery-prize_item img{
        width: 120px;
        height: 120px;
    }
```